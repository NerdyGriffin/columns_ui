parameters:
  installLlvm: ''
  installVcpkg: ''
  msBuildArgs: ''
  platform: ''
  solution: ''
  vcpkgPackages: ''
steps:
- checkout: self
  submodules: recursive
- ${{ if parameters.installLlvm }}:
  - powershell: |
      choco install llvm
      svn checkout https://github.com/llvm/llvm-project/trunk/llvm/tools/msbuild
      ((Get-Content -path msbuild\install.bat -Raw) -replace 'Professional','Enterprise') | Set-Content -Path msbuild\install-enterprise.bat
      cmd /c msbuild\install-enterprise.bat
    displayName: Install LLVM
- ${{ if parameters.installVcpkg }}:
  - script: |
      git clone https://github.com/Microsoft/vcpkg.git
      vcpkg\bootstrap-vcpkg.bat
    displayName: Install Vcpkg
- ${{ if parameters.vcpkgPackages }}:
  - powershell: |
      & $Env:VCPKG_PATH integrate install
      & $Env:VCPKG_PATH install ${{ parameters.vcpkgPackages }}
    env:
      ${{ if parameters.installVcpkg }}:
        VCPKG_PATH: .\vcpkg\vcpkg
      ${{ if not(parameters.installVcpkg) }}:
        VCPKG_PATH: vcpkg
    displayName: Install dependencies
- task: VSBuild@1
  displayName: Build
  inputs:
    solution: ${{ parameters.solution }}
    platform: ${{ parameters.platform }}
    configuration: ${{ parameters.configuration }}
    msbuildArgs: /m ${{ parameters.msBuildArgs }}
